#ifndef beaconspam_h
#define beaconspam_h

#include "Arduino.h"
#include <ESP8266WiFi.h>

extern "C" {
  #include "user_interface.h"
}

class BeaconSpammer {
public:
    BeaconSpammer();
    void main();
    void arm(String ssid, uint8_t len, uint8_t ap_count);
    void toggle_state();
    bool get_state();

private:
    void build_packet(uint8_t counter);
    uint8_t packet_size;
    uint8_t ap_count;
    uint8_t ssid_length;
    bool state;
    uint8_t beacon_packet[83] = {
                /*0*/   0x80, 0x00,                                       // Frame Control
                /*2*/   0x00, 0x00,                                       // Duration
                /*4*/   0xff, 0xff, 0xff, 0xff, 0xff, 0xff,               // DestAddr - broadcast
                /*10*/  0x01, 0x02, 0x03, 0x04, 0x05, 0x06,               // SrcAddr
                /*16*/  0x01, 0x02, 0x03, 0x04, 0x05, 0x06,               // BSSID
                /*22*/  0xc0, 0x6c,                                       // Seq Ctrl
                /*24*/  0x83, 0x51, 0xf7, 0x8f, 0x0f, 0x00, 0x00, 0x00,   // Time stamp - frame body starts here
                /*32*/  0x64, 0x00,                                       // Beacon interval
                /*34*/  0x01, 0x04,                                       // Capability info      
                /*36*/  0x00, 0x20,                                       //  0x00 - SSID, 0x40 - len = 64 c
                /*36*/  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   
                /*46*/  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                /*54*/  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                /*62*/  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,                  
            	  /*70*/  0x01, 0x08,                                       // 0x01 - Supported rates, 0x08 - len 
            	  /*73*/  0x82, 0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c,   // 0x82-0x6c rate
            	  /*81*/  0x03, 0x01, 0x01};                                // 0x03 - channel id, 0x01 - len, 0x01 = WiFi channel 1;

    uint8_t ssid[32] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
};

#endif